<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Archive â€” Tech Murmurs</title>

<style>
body{margin:0;font-family:system-ui;background:#0b0d12;color:#e6e9f0;}
main{max-width:900px;margin:auto;padding:2rem 1rem;}
h1{font-size:2.6rem;margin-bottom:1rem;}
input,button{margin-right:.5rem;margin-bottom:1rem;padding:.5rem;border-radius:6px;border:1px solid #444;}
.idea{background:#121622;border:1px solid #1e2333;border-radius:14px;padding:1.8rem;margin-bottom:1.8rem;}
a{color:#7aa2ff;text-decoration:none;}
</style>
</head>
<body>

<main>
<h1>Archive</h1>

<label>From: <input id="from" type="date"></label>
<label>To: <input id="to" type="date"></label>
<label>Keyword: <input id="kw" type="text" placeholder="search"></label>
<button onclick="filter()">Search</button>

<div id="results"></div>
</main>

<script>
let archive = [];

async function loadArchive(){
  const res = await fetch("/.netlify/functions/archive");
  archive = await res.json();
  render(archive);
}

function filter(){
  const from = document.getElementById("from").value;
  const to = document.getElementById("to").value;
  const kw = document.getElementById("kw").value.toLowerCase();

  const filtered = archive.filter(i=>{
    const d = new Date(i.date);
    if(from && d < new Date(from)) return false;
    if(to && d > new Date(to)) return false;
    if(kw && !i.title.toLowerCase().includes(kw) && !i.murmur.toLowerCase().includes(kw)) return false;
    return true;
  });
  render(filtered);
}

function render(list){
  const out = document.getElementById("results");
  out.innerHTML = list.map(i=>`
    <div class="idea">
      <h2><a href="${i.url}" target="_blank">${i.title}</a></h2>
      <p>${i.murmur}</p>
      <small>${new Date(i.date).toLocaleDateString()}</small>
    </div>
  `).join("");
}

loadArchive();
</script>

</body>
</html>
